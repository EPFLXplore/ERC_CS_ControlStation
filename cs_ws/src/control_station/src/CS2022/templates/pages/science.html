{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>CS2022</title>

	<!-- STYLE -->
	<link href="{% static 'common/border.css' %}" rel="stylesheet">
	<link href="{% static 'science/science.css' %}" rel="stylesheet">
	<link href="{% static 'common/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

	<!-- SCRIPT -->
	<script src="{% static 'common/border.js' %}"></script>
	<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>

	<script>
		$(document).ready(function() {
    		$(document).on('submit', '#launch-form', function() {
				window.location.href ="/CS2022/science/launch";
      			return false;
    		 });
    		$(document).on('submit', '#confirm-form', function() {
				window.location.href ="/CS2022/science/confirm";
      			return false;
    		 });
    		$(document).on('submit', '#abort-form', function() {
				window.location.href ="/CS2022/science/abort";
      			return false;
    		 });
    		$(document).on('submit', '#retry-form', function() {
				window.location.href ="/CS2022/science/retry";
      			return false;
    		 });
		});
	</script>
	
	<!-- ICON -->
	<link rel="icon" type="image/x-icon" href="{% static 'common/Xplore-icon.ico' %}">
</head>

<body>
	{{ tab_name|json_script:"tab-name" }}
	{{ current_state|json_script:"state"  }}

<div id="container">
	<div id="sidebar" class="box">
		<div class="logo">
			<form class="logo-form" action="http://127.0.0.1:8000/CS2022/homepage">
				<input id="imagelogo" type="image" src="{% static 'common/Xplore-logo-white.png' %}" alt="Logo">
		  	</form>
		</div>
	  
		<div class="page-button-container">
			<form action="http://127.0.0.1:8000/CS2022/navigation">
				<button id="navigation" class="page-button">
					<span>NAVIGATION</span>
				</button>
			</form>
			  
			<form action="http://127.0.0.1:8000/CS2022/handlingdevice">
				<button id="handlingdevice" class="page-button">
					<span>HANDLING DEVICE</span>
				</button>
			</form>
			  
			<form action="http://127.0.0.1:8000/CS2022/science">
				<button id="science" class="current-page-button" disabled="true">
					<span>SCIENCE</span>
				</button>
			</form>
			  
			<form action="http://127.0.0.1:8000/CS2022/manualcontrol">
				<button id="manualcontrol" class="page-button">
					<span>MANUAL CONTROL</span>
				</button>
			</form>
			  
			<form action="http://127.0.0.1:8000/CS2022/logs">
				<button id="logs" class="page-button">
					<span>LOGS</span>
				</button>
			</form>

			<div>
				<p style="color: white; margin-top: 15px; font-weight: bold;">ELAPSED TIME</p>
				<p id="elapsed" style="color: white; margin-bottom: 10px; ">00 : 00 : 00</p>

				<img src="{% static 'common/ok.png' %}" alt="" width="48" height="48" style="margin-top: 10px; margin-right: 10px; opacity: 1;">
				<img src="{% static 'common/warning.png' %}" alt="" width="40" height="40" style="margin-top: 10px; opacity: 0.2;">
				<img src="{% static 'common/error.png' %}" alt="" width="42" height="42" style="margin-top: 10px; opacity: 0.2; margin-left:15px;">


			</div>
			
		</div>
	
		<div class="square-state-button-box" style="margin-top: 780px;">
			<div class="state-button-container">
				<form  class="state-button-form" method="POST">
					{% csrf_token %}
					<input id="launch-button" class="state-button" type="submit" value="LAUNCH">
					
				</form>
			</div>
			
			<div class="state-button-container">
				<form  class="state-button-form" method="POST">
					{% csrf_token %}
					<input id="wait-button" class="state-button" type="submit" value="WAIT">
					
				</form>
			</div>
			
			<div class="state-button-container">
				<form  class="state-button-form" method="POST">
					{% csrf_token %}
					<input id="abort-button" class="state-button" type="submit" value="ABORT">
					
				</form>
			</div>


			<div class="state-button-container">
				<form  class="state-button-form" method="POST">
					{% csrf_token %}
					<input id="resume-button" class="state-button" type="submit" value="RESUME">
					
				</form>
			</div>
		</div>
		
	</div>
	
  	<div id="right-side" class="box">
  		<div class="top-bar">
  			<label id="idle-state" class="neon-label">IDLE</label>
  			<label id="navigation-state" class="neon-label">NAVIGATION</label>
  			<label id="hd-state" class="neon-label">HANDLING DEVICE</label>
  			<label id="science-state" class="neon-label">SCIENCE</label>
  			<label id="manual-state" class="neon-label">MANUAL CONTROL</label>
  			<label id="waiting-state" class="neon-label">WAITING</label>		
  		</div>
  		<script>
				
			document.querySelector("#launch-button").addEventListener("click", event => {
				event.preventDefault();

				var elem1 = document.getElementById('navigation-state');
				var elem2 = document.getElementById('idle-state');
				var elem3 = document.getElementById('hd-state');
				var elem4 = document.getElementById('manual-state');
				var elem5 = document.getElementById('waiting-state');
				var elem6 = document.getElementById('science-state');

				elem1.style.opacity = 0.2;
				elem2.style.opacity = 0.2;
				elem3.style.opacity = 0.2;
				elem4.style.opacity = 0.2;
				elem5.style.opacity = 0.2;
				elem6.style.opacity = 1;



				let csrfTokenValue = document.querySelector('[name=csrfmiddlewaretoken]').value;
				let request = new Request('launch/', {method: 'POST',
													body: '',
													headers: {"X-CSRFToken": csrfTokenValue}})
				fetch(request)
					.then(response => response.json())
					.then(result => {})
			})

			
		</script>
  		<div id="page" class="page">
			<div style="float: left;  width: 75%; height: 100%;">

				<div style="width: 600px; height: 50%; float: left; ">

					<div style="float: left; width: 150px; color: white; font-weight: bold; margin-top: 20px; margin-left: 20px;">
						<p>TUBE 1</p>

						<div>
							<p style="font-size: small; float:left;">humidity    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>
						<div >
							<p style="font-size: small; float: left;">color    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>
						
						<div style="float: left;">
							<p style="font-size: small; float: left; ">mass	    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>

						<div style="float: left;">
							<p style="font-size: small; float: left; ">particle size:</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>

						<div style="float: left;">
							<p style="font-size: small; float: left; ">volume    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>

						<div style="float: left;">
							<p style="font-size: small; float: left; ">density    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>
						

					</div>

					<div style=" border-left: 2px solid rgb(75, 75, 81); height: 250px; float:left; padding-right: 30px; margin-top: 30px;"> </div>

					<div style="float: left; width: 150px; color: white; font-weight: bold; margin-top: 20px; margin-top: 20px;">
						<p>TUBE 2</p>
						<div style="float: left;">
							<p style="font-size: small; float: left; ">mass	    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>
					
					</div>

					<div style=" border-left: 2px solid rgb(75, 75, 81); height: 250px; float:left; padding-right: 30px; margin-top: 30px;"> </div>

					<div style="float: left; width: 150px; color: white; font-weight: bold; margin-top: 20px; margin-top: 20px;">
						<p>TUBE 3</p>
						<div style="float: left;">
							<p style="font-size: small; float: left; ">mass	    :</p>
							<p style="font-size: small;  padding-left: 100px;">0</p>
						</div>
					</div>

					<br style="clear: left;" />
				</div>
				

				<div style="width: 650px;  height: 50%; float: left; color: white;">
					
					<div style="margin-top: 20px; ">
						<p style="font-weight: bold;">TUBE SELECTION</p>
						<div class="tube-submit-box" style="float: left">
							<form action="" method="POST" class="tube-form"> 
								
								<div class="submit-column">
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube1" value="1">
										<label class="tube-form-check-label" for="inlineRadio1">1</label>
									</div>
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube2" value="2">
										<label class="tube-form-check-label" for="inlineRadio2">2</label>
									</div>
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube3" value="3">
										<label class="tube-form-check-label" for="inlineRadio3">3</label>
									</div>
								</div>
								
							</form>
						</div>
					</div>
					<div >
						<p style="font-weight: bold;">POSITION SELECTION</p>
						<div class="tube-submit-box" style="float: left;">
							<form action="" method="POST" class="tube-form"> 
								
								<div class="submit-column">
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube1" value="10">
										<label class="tube-form-check-label" for="inlineRadio1">caching</label>
									</div>
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube2" value="20">
										<label class="tube-form-check-label" for="inlineRadio2">analysis</label>
									</div>
									<div class="tube-form-check">
										<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube3" value="30">
										<label class="tube-form-check-label" for="inlineRadio3">sampling</label>
									</div>
								</div>
								
							</form>

						</div>
					</div>
					<div style="float:left;">
						<P style="font-weight: bold;">VALIDATION</P>
						<form  class="state-button-form" method="POST">
							{% csrf_token %}
							<input id="set-ok" class="state-button" type="submit" value="OK">
							
						</form>

						<script>

							document.querySelector("#set-ok").addEventListener("click", event => {
								event.preventDefault();
									
								let selected = document.querySelectorAll("input[type=radio]:checked")
								
								if(selected.length != 2) {
									throw "Must select tube + operation"
								}
								
								let formData = new FormData();
								formData.append('tube', selected.item(0).value);
								formData.append('operation', selected.item(1).value);
					
					
								let csrfTokenValue = document.querySelector('[name=csrfmiddlewaretoken]').value;
								let request = new Request('set_tube_cmd/', {method: 'POST',
																	body: formData,
																	headers: {"X-CSRFToken": csrfTokenValue}})
								fetch(request)
									.then(response => response.json())
									.then(result => {})
								})

						</script>
						
					</div>
					
					
				</div>

				<div style="width: 600px; height: 50%; float: left;">
					<p style="font-weight: bold; color:white; margin-left: 20px;">ANALYSIS</p>
					<div style="width: 50%; margin-left: 20px;">
					<form  class="state-button-form" method="POST" >
							{% csrf_token %}
							<input id="l" class="state-button" type="submit" value="PARTICLE SIZE">
							
						</form>
						<form  class="state-button-form" method="POST">
							{% csrf_token %}
							<input id="l" class="state-button" type="submit" value="COLOR ANALYSIS">
							
						</form>
						<form  class="state-button-form" method="POST">
							{% csrf_token %}
							<input id="l" class="state-button" type="submit" value="DENSITY">
							
						</form>
					</div>
				</div>

				<div style="width: 650px; height: 50%; float: left;">
					<p style="font-weight: bold; color:white;">BAY TRAP AND CACHING</p>
					<label class="toggle">
						<input class="toggle-checkbox" type="checkbox">
						<div class="toggle-switch"></div>
						<span class="toggle-label">Open Trap</span>
					</label>

					<!-- <div class="tube-submit-box" style="float: left;">
						<form action="" method="POST" class="tube-form"> 
							
							<div class="submit-column">
								<div class="tube-form-check">
									<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube1" value="pos1">
									<label class="tube-form-check-label" for="inlineRadio1">P1</label>
								</div>
								<div class="tube-form-check">
									<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube2" value="pos2">
									<label class="tube-form-check-label" for="inlineRadio2">P2</label>
								</div>
								<div class="tube-form-check">
									<input class="tube-form-check-input" type="radio" name="tubeSelect" id="check-tube3" value="pos3">
									<label class="tube-form-check-label" for="inlineRadio3">P3</label>
								</div>
							</div>
							
						</form>
					</div>-->
				</div>
				
				



			</div>

			<div class="bottom-science-box">
				
				<div class="gallery-box">
					<div class="scrollable-gallery">
						<div class="picture-container">
							
						</div>
						<div class="picture-container">
							
						</div>
						<div class="picture-container">
							
						</div>
							
					</div>
				</div>
				
			</div>
			<div style="background-color: green; height:50%;">

			</div>

			
				
		</div>
  	</div>  
</div>
  	
  </div>
  <script>

	const tabName = JSON.parse(document.getElementById('tab-name').textContent);
	const chatSocket = new WebSocket(
		'ws://'
		+ window.location.host
		+ '/ws/CS2022/'
		+ tabName
		+ '/'
	);

	chatSocket.onmessage = function(e) {
		const data = JSON.parse(e.data);
		
		console.log("debug")


	};

	chatSocket.onclose = function(e) {
		console.log('Switched Tab');
	};

	const timeSocket = new WebSocket(
		'ws://'
		+ window.location.host
		+ '/ws/CS2022/'
		+ 'time'
		+ '/'
	);

	timeSocket.onmessage = function(e) {
		const data = JSON.parse(e.data);
		
		console.log("debug timer");
		var time = `${data.hor} : ${data.min} : ${data.sec}`;
		document.getElementById('elapsed').innerHTML    = time;

	};
	

</script>
<script src="{% static 'common/common.js' %}"></script>

</body>

</html>
