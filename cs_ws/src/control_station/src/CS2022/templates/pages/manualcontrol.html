{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>CS2022</title>
  
	<!-- STYLE -->
	<link href="{% static 'common/border.css' %}" rel="stylesheet">
	<link href="{% static 'manualcontrol/manualcontrol.css' %}" rel="stylesheet">
	<link href="{% static 'common/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">

	<!-- SCRIPT -->
	<script src="{% static 'common/border.js' %}"></script> 
	<script src="{% static 'manualcontrol/manualcontrol.js' %}"></script> 
	<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
	
	<script>
		$(document).ready(function() {
    		$(document).on('submit', '#launch-form', function() {
				window.location.href ="/CS2022/manualcontrol/launch";
      			return false;
    		 });
    		$(document).on('submit', '#wait-form', function() {
				window.location.href ="/CS2022/manualcontrol/wait";
      			return false;
    		 });
    		$(document).on('submit', '#abort-form', function() {
				window.location.href ="/CS2022/manualcontrol/abort";
      			return false;
    		 });
    		$(document).on('submit', '#resume-form', function() {
				window.location.href ="/CS2022/manualcontrol/resume";
      			return false;
    		 });
    		$(document).on('submit', '#direct-form', function() {
      			return false;
    		 });
    		$(document).on('submit', '#inverse-form', function() {
      			return false;
    		 });
		});
	</script>
	
	<!-- ICON -->
	<link rel="icon" type="image/x-icon" href="{% static 'common/Xplore-icon.ico' %}">
</head>

<body>
	{{ tab_name|json_script:"tab-name" }}
	{{ current_state|json_script:"state"  }}

	<div id="container">
		<div id="sidebar" class="box">
			<div class="logo">
				<form class="logo-form" action="http://127.0.0.1:8000/CS2022/homepage">
					<input id="imagelogo" type="image" src="{% static 'common/Xplore-logo-white.png' %}" alt="My image">
				</form>
			</div>
		
			<div class="page-button-container">
				<form action="http://127.0.0.1:8000/CS2022/navigation">
					<button id="navigation" class="page-button">
						<span>NAVIGATION</span>
					</button>
				</form>
					
				<form action="http://127.0.0.1:8000/CS2022/handlingdevice">
					<button id="handlingdevice" class="page-button">
						<span>HANDLING DEVICE</span>
					</button>
				</form>
				
				<form action="http://127.0.0.1:8000/CS2022/science">
					<button id="science" class="page-button">
						<span>SCIENCE</span>
					</button>
				</form>
			
				<form action="http://127.0.0.1:8000/CS2022/manualcontrol">
					<button id="manualcontrol" class="current-page-button" disabled="true">
						<span>MANUAL CONTROL</span>
					</button>
				</form>
				
				<form action="http://127.0.0.1:8000/CS2022/avionics">
					<button id="avionics" class="page-button">
						<span>AVIONICS</span>
					</button>
				</form>
				<div>
					<p style="color: white; margin-top: 15px; font-weight: bold;">ELAPSED TIME</p>
					<p id="elapsed" style="color: white; margin-bottom: 10px; ">00 : 00 : 00</p>

					<img src="{% static 'common/ok.png' %}" alt="" width="48" height="48" style="margin-top: 10px; margin-right: 10px; opacity: 1;">
					<img src="{% static 'common/warning.png' %}" alt="" width="40" height="40" style="margin-top: 10px; opacity: 0.2;">
					<img src="{% static 'common/error.png' %}" alt="" width="42" height="42" style="margin-top: 10px; opacity: 0.2; margin-left:15px;">


				</div>
			</div>
		
			<div class="square-state-button-box" style="margin-top: 780px;">

				<div class="state-button-container">
					<form  class="state-button-form" method="POST">
						{% csrf_token %}
						<input id="launch-button" class="state-button" type="submit" value="LAUNCH">
						
					</form>
				</div>
				
				<div class="state-button-container">
					<form  class="state-button-form" method="POST">
						{% csrf_token %}
						<input id="wait-button" class="state-button" type="submit" value="WAIT">
						
					</form>
				</div>
				
				<div class="state-button-container">
					<form  class="state-button-form" method="POST">
						{% csrf_token %}
						<input id="abort-button" class="state-button" type="submit" value="ABORT">
						
					</form>
				</div>


				<div class="state-button-container">
					<form  class="state-button-form" method="POST">
						{% csrf_token %}
						<input id="resume-button" class="state-button" type="submit" value="RESUME">
						
					</form>
				</div>
				<script>
				
					document.querySelector("#launch-button").addEventListener("click", event => {
						event.preventDefault();
		
						var elem1 = document.getElementById('navigation-state');
						var elem2 = document.getElementById('idle-state');
						var elem3 = document.getElementById('hd-state');
						var elem4 = document.getElementById('manual-state');
						var elem5 = document.getElementById('waiting-state');

						elem1.style.opacity = 0.2;
						elem2.style.opacity = 0.2;
						elem3.style.opacity = 0.2;
						elem4.style.opacity = 1;
						elem5.style.opacity = 0.2;
		
		
						let csrfTokenValue = document.querySelector('[name=csrfmiddlewaretoken]').value;
						let request = new Request("launch/", {method: 'POST',
															body: '',
															headers: {"X-CSRFToken": csrfTokenValue}})
						fetch(request)
							.then(response => response.json())
							.then(result => {})
					})
		
					
				</script>

			</div>

			

			
		</div>
		
		<div id="right-side" class="box">

			<div class="top-bar">
				<label id="idle-state" class="neon-label">IDLE</label>
				<label id="navigation-state" class="neon-label">NAVIGATION</label>
				<label id="hd-state" class="neon-label">HANDLING DEVICE</label>
				<label id="science-state" class="neon-label">SCIENCE</label>
				<label id="manual-state" class="neon-label">MANUAL CONTROL</label>
				<label id="waiting-state" class="neon-label">WAITING</label>		
			</div>
			
			<div id="page" class="page">
					
				<div class="left">
					<div class="top-left">
					
						<img id="camera_1" src="{% static 'common/logothumbnail.png' %}" height="100%" width="100%">
						<p id="envmap-title">CAMERA 1</p>
						
					</div>

					<div class="h-separator"></div>

					<div class="bottom-left">
					
						<img id="camera_2" src="{% static 'common/logothumbnail.png' %}" height="100%" width="100%">
						<p id="envmap-title">CAMERA 2</p>

					</div>

				</div>

				<div class="v-separator"></div>

				<div class="right">
			
					<div class="settings-container">
						<div class="settings-top-bar">
							<div class="currentpos-container">
								<div class="pos-title-c">
									<p class="pos-title">CURRENT POSITION:</p>
								</div>
								<div class="pos-coord">
									<div class="coord-c">
										<p class="coord-type">X</p>
										<p class="coordinate">0.00</p>
									</div>
									<div class="coord-c">
										<p class="coord-type">Y</p>
										<p class="coordinate">0.00</p>
									</div>
									<div class="coord-c">
										<p class="coord-type">Z</p>
										<p class="coordinate">0.00</p>
									</div>
								</div>
							</div>
							<div class="velocity-container">
								<div class="velocity-title-c">
									<p class="velocity-title">VELOCITY:</p>
								</div>
								<div class="velocity-type-container">
									<div class="velocity-type-c">
										<p class="velocity-type">Linear:</p>
										<p class="velocity">0.00</p>
									</div>
									<div class="velocity-type-c">
										<p class="velocity-type">Angular:</p>
										<p class="velocity">0.00</p>
									</div>
								</div>
							</div>
						</div>

						<div class="settings-bottom">

							<div id="interactive_box" class="settings">
								<div id="direct_box" class="settings_box">
									<div class="settings-title-box">
										<p class="settings-title">ENCODERS DATA:</p>
									</div>
									<ul style="color: white; margin-left: 45px;">
										<li>e1: </li>
										<li>e2: </li>
										<li>e3: </li>
										<li>e4: </li>
										<li>e5: </li>
										<li>e6: </li>
									</ul>
								</div>
							</div>

							

							<div style="margin-top: 30px;">	
								<div id="inverse_box" class="settings_box">
								<div class="settings-title-box">
									<p class="settings-title">INVERSE KINEMATICS</p>
								</div>
								<div class="settings-values-box">
									
									<div class="data-line">
										<div class="settings-value-container">
											<input type="number" class="data-input" placeholder="X" name="x"/>
											
										</div>
										<div class="settings-value-container">
											<input type="number" class="data-input" placeholder="Y" name="y"/>
											
										</div>
										<div class="settings-value-container">
											<input type="number" class="data-input" placeholder="Z" name="z"/>
											
										</div>
									</div>
								</div>
								<div class="settings-buttons-box">
									<div class="set-box">
										<form class="set-form" action="">
											<button class="set-button">
												<span>SET</span>
											</button>
										</form>
									</div>
								</div>

							</div>
						</div>
						
					</div>
				</div>
				<!-- cameras grid -->
				<div class="row">
					<div class="column">
						
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">

					</div>
					<div class="column">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%">
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%"> 
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%"> 
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%"> 
					  <img src="{% static 'common/logothumbnail.png' %}" width="17%"> 

					</div>
					
				  </div>
			</div>
		</div>
	</div>
	<!-- =================================================================================================================== -->
	<script>

		const tabName = JSON.parse(document.getElementById('tab-name').textContent);

		// ----------------------------------------------------------------------
		// Data
		const chatSocket = new WebSocket(
			'ws://'
			+ window.location.host
			+ '/ws/CS2022/'
			+ tabName
			+ '/'
		);
	
		chatSocket.onmessage = function(e) {
			const data = JSON.parse(e.data);
			
			console.log("debug")
	
	
		};
	
		chatSocket.onclose = function(e) {
			console.log('Switched Tab');
		};

		// --------------------------------------------------------------------------
		// Cameras
		let ws = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/video/'
            + 'wms'
            + '/'
        );

        ws.onmessage = function(evt) {
            v_data = JSON.parse(evt.data);
            $("#camera_1").attr("src", v_data.message);
            
        };

        ws.onclose = function(evt) {
            console.log("Connection closed.");
        };
	
		const timeSocket = new WebSocket(
		'ws://'
		+ window.location.host
		+ '/ws/CS2022/'
		+ 'time'
		+ '/'
		);

		timeSocket.onmessage = function(e) {
			const data = JSON.parse(e.data);
			
			console.log("debug timer");
			var time = `${data.hor} : ${data.min} : ${data.sec}`;
			document.getElementById('elapsed').innerHTML    = time;

		};
	</script>
	<script src="{% static 'common/common.js' %}"></script>

	<!-- ================================================================================================================= -->
</body>

</html>
